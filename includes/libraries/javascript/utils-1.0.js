InlineEdit=function(a){this.init(a)};InlineEdit.prototype={object:null,enabled:true,method:"get",server:"",column:"",idName:"id",hoverClass:null,inputWidth:null,inputClass:null,init:function(b){var a=this;this.object=b;$(this.object).mouseover(function(){if(!a.enabled){return}if(a.hoverClass!==null){$(this).addClass(a.hoverClass)}}).mouseout(function(){if(!a.enabled){return}if(a.hoverClass!==null){$(this).removeClass(a.hoverClass)}}).click(function(){if(!a.enabled){return}a.enableEdit(this)})},enable:function(){this.enabled=true},disable:function(){this.enabled=false},onFailed:function(a){alert(a.msg)},onSubmit:function(a){return true},enableEdit:function(c){var b=this;var e=$('<input type="text" />');var d=$(c).html();if(b.inputClass!==null){e.addClass(b.inputClass)}if(b.inputWidth!==null){e.css("width",b.inputWidth)}e.val(d);var a=function(){$(e).remove();$(c).show()};e.blur(function(){var h=this.value;if(d!=h){if(b.onSubmit(h)){var f=$(c).attr("querystring")?"&"+$(c).attr("querystring"):"";var g={};g.column=b.column;g.value=h;g.ajax="";if(b.idName!==null){g[b.idName]=$(c).attr("idvalue")}$.ajax({type:b.method,url:b.server,data:g,dataType:"json",success:function(i){if(i.done){$(c).html(i.retval)}else{b.onFailed(i)}a()},error:function(l,i,j){alert(i);a()}})}else{a()}}else{a()}});$(c).hide();$(c).after(e);$(e).select()}};ToggleEdit=function(a){this.init(a)};ToggleEdit.prototype={object:null,enabled:true,method:"get",server:"",column:"",idName:"id",hoverClass:null,toggleData:{on:"toggle_on",off:"toggle_off"},init:function(b){var a=this;this.object=b;$(this.object).mouseover(function(){if(!a.enabled){return}if(a.hoverClass!==null){$(this).addClass(a.hoverClass)}}).mouseout(function(){if(!a.enabled){return}if(a.hoverClass!==null){$(this).removeClass(a.hoverClass)}}).click(function(){if(!a.enabled){return}a.toggleStatus(this)})},enable:function(){this.enabled=true},disable:function(){this.enabled=false},toggleStatus:function(e){var a=this;if(!a.onSubmit(e)){return}var c=this.getSetData($(e).attr("status"));var b=$(e).attr("querystring")?"&"+$(e).attr("querystring"):"";var d=a.idName===null?"":"&"+a.idName+"="+$(e).attr("idvalue");$.ajax({type:a.method,url:a.server,data:"column="+a.column+"&value="+c.value+d+b,dataType:"json",success:function(f){if(typeof(f)!="object"){alert("result error:"+f);return}if(!f.done){a.onFailed(f);return}a.toggleClass(e);$(e).attr("status",c.status)},error:function(h,f,g){alert(f)}})},getToggleData:function(){var a={on:{"class":"toggle_on",value:1},off:{"class":"toggle_off",value:0}};if(typeof(this.toggleData.on)=="string"){a.on["class"]=this.toggleData.on}else{a.on=this.toggleData.on}if(typeof(this.toggleData.off)=="string"){a.off["class"]=this.toggleData.off}else{a.off=this.toggleData.off}return a},getSetData:function(b){var a=this.getToggleData(),c;if(b=="on"){c=a.off;c.status="off"}else{c=a.on;c.status="on"}return c},toggleClass:function(b){var a=this.getToggleData();$(b).toggleClass(a.on["class"]);$(b).toggleClass(a.off["class"])},onFailed:function(a){alert(a.msg)},onSubmit:function(a){return true}};EditableTable=function(a){this.init(a)};EditableTable.prototype={table:null,columns:{},init:function(a){this.table=a;this.columns=this.getColumnsInfo();for(k in this.columns){this.initColumn(this.columns[k])}},getColumnsInfo:function(){var _self=this,columns={},table_header,tds,all_col;table_header=$(_self.table).find('tr[ectype="table_header"]');tds=table_header.find("[column]");all_col=table_header.find("th, td");tds.each(function(){columns[$(this).attr("column")]={name:$(this).attr("column"),index:all_col.index(this),coltype:$(this).attr("coltype"),expr:$(this).attr("expr")?$(this).attr("expr"):'[ectype="editobj"]',checker:$(this).attr("checker")?eval($(this).attr("checker")):null,editor:null,dom:this,colhover:$(this).attr("colhover")?$(this).attr("colhover"):"utils_default_colhover"}});return columns},initColumn:function(a){if(!a.coltype){return}this.columnEffect(a);this.columnEditable(a)},columnEffect:function(a){var b=this.getColItems(a);b.each(function(){var c=$(this).parent().attr("idvalue");$(this).find(a.expr).attr("idvalue",c)});b.hover(function(){b.addClass(a.colhover)},function(){b.removeClass(a.colhover)})},columnEditable:function(e){var g=this.getColItems(e);var a;var d=$(g).find(e.expr).get();if(e.coltype=="switchable"){var c,j,i,b;c=$(e.dom).attr("onclass")?$(e.dom).attr("onclass"):"utils_default_toggle_on";j=$(e.dom).attr("onvalue")?$(e.dom).attr("onvalue"):1;i=$(e.dom).attr("offclass")?$(e.dom).attr("offclass"):"utils_default_toggle_off";b=$(e.dom).attr("offvalue")?$(e.dom).attr("offvalue"):0;a=new ToggleEdit(d);a.toggleData={on:{"class":c,value:j},off:{"class":i,value:b}}}else{if(e.coltype=="editable"){var f=$(e.dom).attr("inputwidth"),h=$(e.dom).attr("inputclass");a=new InlineEdit(d);if(f){a.inputWidth=f}a.inputClass=h?h:"utils_default_input_class";if(e.checker){a.onSubmit=e.checker}}}a.hoverClass=$(e.dom).attr("hoverclass")?$(e.dom).attr("hoverclass"):null;a.server=$(this.table).attr("server");a.column=e.name;this.columns[e.name].editor=a},getColItems:function(c){var a=this,e,b,d;b=$(a.table).find('tr[ectype="table_item"]');e=b.find("td:eq("+c.index+")");return e}};
