(function(a){a.fn.jqTreeTable=function(o,b){var h=a.extend({openImg:"",shutImg:"",leafImg:"",lastOpenImg:"",lastShutImg:"",lastLeafImg:"",vertLineImg:"",blankImg:"",collapse:false,column:0,striped:false,highlight:false,state:true},b),p=[],n=[],l=this.attr("id"),g=[],k=function(){if(h.striped){$("#"+l+" tr:visible").filter(":even").addClass("even").end().filter(":odd").removeClass("even")}},r=function(z,B){var u=p[z],x=0,v="",C,w;for(var A=0,t=u.length;A<t;A++){x=u[A];if(p[x]){v=(A==t-1)?h.blankImg:h.vertLineImg;w=(A==t-1)?h.lastOpenImg:h.openImg;n[x-1]=B+'<img src="'+w+'" class="parimg" id="'+l+x+'">';C=B+'<img src="'+v+'" class="preimg">';arguments.callee(x,C)}else{w=(A==t-1)?h.lastLeafImg:h.leafImg;n[x-1]=B+'<img src="'+w+'" class="ttimage" id="'+l+x+'">'}}},c=function(u,w){a("#"+l+u).attr("src",(w)?h.lastOpenImg:h.openImg);for(var t=0,y=p[u].length;t<y;t++){var v=p[u][t];a("#"+l+v).parents("tr").removeClass("collapsed");if(p[v]&&h.state&&a.inArray(v,g)<0){arguments.callee(v,(t==y-1))}}},q=function(u,w){a("#"+l+u).attr("src",(w)?h.lastShutImg:h.shutImg);for(var t=0,y=p[u].length;t<y;t++){var v=p[u][t];a("#"+l+v).parents("tr").addClass("collapsed");if(p[v]){arguments.callee(v,(t==y-1))}}},s=function(t,v){var u=(v)?g.splice(a.inArray(t,g),1):g.push(t);d(l,g)},j=function(x){var t="",w=" "+document.cookie+";",u=w.indexOf(" "+x+"=");if(u>=0){u+=x.length+2;t=(w.substring(u,w.indexOf(";",u))).split("|")}return t||0},d=function(u,t){a.unique(t);document.cookie=u+"="+t.join("|")+";"};for(var f=0,i=o.length;f<i;f++){num=o[f];if(!p[num]){p[num]=[]}p[num].push(f+1)}r(0,"");a("tr",this).each(function(t){a(this).children("td").eq(h.column).prepend(n[t])});g=j(l)||h.collapse||g;if(g.length){d(l,g);for(var e=0,m=g.length;e<m;e++){q(g[e],($("#"+g[e]+" .parimg").attr("src")==h.lastOpenImg))}}k();a(".parimg",this).each(function(u){var t=a(this),v;t.click(function(){var w=parseInt(t.attr("id").substr(l.length));if(t.parents("tr").next().is(".collapsed")){c(w,(t.attr("src")==h.lastShutImg));if(h.state){s(w,true)}}else{q(w,(t.attr("src")==h.lastOpenImg));if(h.state){s(w,false)}}k()})});if(h.highlight){a("tr",this).hover(function(){a(this).addClass("over")},function(){a(this).removeClass("over")})}};return this})(jQuery);
